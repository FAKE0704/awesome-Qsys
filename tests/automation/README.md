# 自动化测试说明

## 概述

本目录包含自动化回测测试套件，用于验证规则解析器和回测引擎的功能，无需手动操作界面。

## 文件说明

### 核心文件
- `test_backtest_automation.py` - 主要的自动化测试套件
- `run_automation_tests.py` - 快速运行脚本（项目根目录）
- `test_single_rule.py` - 单规则快速测试工具（项目根目录）

## 使用方法

### 1. 完整测试套件

运行完整的自动化测试套件：

```bash
# 方法1: 使用快速运行脚本
python run_automation_tests.py

# 方法2: 直接运行测试文件
python tests/automation/test_backtest_automation.py
```

测试内容：
- 基础SMA策略
- RSI超买超卖策略
- 多重条件策略
- REF函数策略
- 复杂嵌套策略

### 2. 单规则测试

快速测试单个规则表达式：

```bash
python test_single_rule.py
```

功能：
- 预定义规则测试
- 自定义规则输入
- 快速验证规则语法和逻辑
- 实时显示测试结果

### 3. 测试报告

测试完成后会生成：
- 控制台输出：实时测试结果和汇总信息
- JSON报告文件：`test_report_YYYYMMDD_HHMMSS.json` - 包含详细测试数据

## 测试特性

### 验证项目
1. **回测流程** - 完整的回测执行流程
2. **规则解析** - 各种规则表达式的正确性
3. **指标计算** - SMA、RSI等技术指标
4. **调试数据** - 规则解析器生成的调试数据
5. **信号生成** - 交易信号的生成逻辑

### 调试数据分析
- 数据列数量统计
- 指标列识别（SMA、RSI、MACD、REF等）
- 规则表达式结果列识别
- 调试数据完整性验证

### 错误处理
- 规则语法错误捕获
- 运行时异常处理
- 详细的错误信息输出

## 自定义测试

### 添加新测试用例

在 `test_backtest_automation.py` 中的 `run_test_suite` 方法中添加新的测试用例：

```python
{
    'name': '你的测试名称',
    'config': self.create_test_config("自定义规则", {
        'buy_rule': '你的买入规则',
        'sell_rule': '你的卖出规则'
    })
}
```

### 自定义测试数据

修改 `_create_test_data` 方法来生成特定的测试数据：
- 调整数据天数
- 修改价格走势模式
- 添加特定的市场条件

## 故障排除

### 常见问题

1. **导入错误**
   - 确保在项目根目录运行脚本
   - 检查Python路径设置

2. **规则语法错误**
   - 使用 `test_single_rule.py` 快速验证规则语法
   - 检查指标函数名称和参数

3. **数据问题**
   - 测试使用模拟数据，与真实市场数据可能有差异
   - 可以调整随机种子来改变测试数据

### 调试技巧

1. **查看详细错误信息**
   - 测试失败时会显示详细的错误堆栈

2. **分析调试数据**
   - 测试报告会显示生成的数据列信息
   - 验证指标计算和规则结果是否正确

3. **单独测试规则**
   - 使用 `test_single_rule.py` 快速验证特定规则

## 扩展功能

可以考虑添加的功能：
- 真实市场数据测试
- 性能基准测试
- 批量规则验证
- 可视化测试结果
- 回归测试套件