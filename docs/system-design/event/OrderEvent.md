一、信号处理与订单生成
## ​信号事件转换​
当策略模块生成`SignalEvent`（包含时间戳、标的、方向1/-1）后，将其推送至事件队列。交易执行模块监听该事件，将其转换为OrderEvent：
​订单参数​：基于信号方向、预设仓位比例、当前账户可用资金/持仓量，计算目标交易数量
。
​订单类型​：市价单（立即执行）或限价单（需指定价格阈值），后者需结合盘口数据模拟
。
## ​风险管理拦截​
在订单提交前，需通过风控模块检查：
可用资金是否覆盖买入成本（含手续费预估）
。
卖出时持仓是否充足
。
单笔交易风险是否超过账户总资产的设定比例（如2%）
。
⚙️ 二、订单管理与执行模拟
## ​订单簿与撮合逻辑​
市价单：以当前Bar的收盘价或下一Bar开盘价成交，加入滑点模拟（如±0.1%）
。
限价单：持续挂单直至价格触发或订单过期，需记录挂单时间
。
表：订单执行逻辑对比
| ​订单类型​ | ​成交价逻辑​ | ​滑点处理​ |
|--------------|------------------------|--------------------------|
| 市价单 | 当前/次周期开盘价 | 按比例调整成交价 |
| 限价单 | 指定价格±滑点容差 | 仅在触发价范围内成交 |

## ​生成成交事件​
订单成交后触发`FillEvent`，包含：
实际成交价、数量、手续费（按比例或固定值计算）
。
滑点成本（成交价与预期价的差值）
。
📊 三、投资组合更新与状态记录
## ​实时更新账户状态​
​多头/空头持仓​：根据成交方向增减仓位
。
​现金与资产总值​：现金扣除买入成本（或增加卖出收入），资产总值按最新市价重估
。
​未实现盈亏​：持仓市值与成本价的差值
。
## ​交易日志记录​
保存每笔交易的：
时间、标的、方向、成交量、成交价、手续费
。
关联的信号来源（用于后期分析信号有效性）
。
📈 四、绩效评估与可视化
## ​关键指标计算​
​收益指标​：总收益率、年化收益率、夏普比率
。
​风险指标​：最大回撤、波动率、Calmar比率
。
​交易质量​：胜率、盈亏比、平均持仓周期
。
## ​可视化输出​
资产曲线 vs. 基准曲线（如沪深300）
。
买卖信号在价格序列上的标记（用↑↓标注）
。
回撤曲线与持仓变动热力图
。
⚠️ 五、事件驱动架构的核心机制
​事件循环流程​：
SignalEvent → OrderEvent → FillEvent → PortfolioUpdate → Next Bar
。
​避免未来函数​：确保信号仅基于历史数据生成，执行时严格按时间戳顺序处理
。
​异步事件处理​：高频率回测需使用优先级队列，确保事件按时间顺序处理
